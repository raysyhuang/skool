{% extends "base.html" %}

{% block title %}Skool - Who's Learning Today?{% endblock %}

{% block theme_css %}
<style>
    /* ── Login page styles ── */
    :root {
        --login-bg: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        --card-son: #ff6b35;
        --card-son-hover: #ff8c5a;
        --card-daughter: #e84393;
        --card-daughter-hover: #fd79a8;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
        width: 100%; height: 100%;
        overflow: hidden;
        font-family: -apple-system, "PingFang SC", "Noto Sans SC", "Helvetica Neue", Arial, sans-serif;
    }

    body {
        background: var(--login-bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100dvh;
    }

    /* ── Floating stars background ── */
    .stars {
        position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 0;
    }
    .stars span {
        position: absolute;
        font-size: 28px;
        animation: float 6s ease-in-out infinite;
        opacity: 0.5;
    }
    .stars span:nth-child(1) { left: 10%; top: 15%; animation-delay: 0s; }
    .stars span:nth-child(2) { left: 25%; top: 70%; animation-delay: 1s; }
    .stars span:nth-child(3) { left: 55%; top: 20%; animation-delay: 2s; }
    .stars span:nth-child(4) { left: 80%; top: 60%; animation-delay: 0.5s; }
    .stars span:nth-child(5) { left: 40%; top: 85%; animation-delay: 3s; }
    .stars span:nth-child(6) { left: 70%; top: 10%; animation-delay: 1.5s; }
    .stars span:nth-child(7) { left: 90%; top: 40%; animation-delay: 2.5s; }
    .stars span:nth-child(8) { left: 5%; top: 50%; animation-delay: 4s; }

    @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
    }

    /* ── Main container ── */
    .login-container {
        position: relative; z-index: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 32px;
        padding: 24px;
        width: 100%;
        max-width: 800px;
    }

    .login-title {
        font-size: clamp(32px, 6vw, 56px);
        color: #fff;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        text-align: center;
        line-height: 1.3;
    }

    /* ── Avatar grid ── */
    .avatar-grid {
        display: flex;
        gap: 32px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .avatar-btn {
        width: clamp(180px, 28vw, 260px);
        height: clamp(200px, 32vw, 300px);
        border: none;
        border-radius: 32px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 8px 30px rgba(0,0,0,0.25);
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }
    .avatar-btn:active {
        transform: scale(0.94);
    }
    .avatar-btn:hover {
        transform: scale(1.04);
        box-shadow: 0 12px 40px rgba(0,0,0,0.35);
    }

    .avatar-btn[data-theme="racing"] {
        background: linear-gradient(145deg, var(--card-son), #e55a2b);
    }
    .avatar-btn[data-theme="racing"]:hover {
        background: linear-gradient(145deg, var(--card-son-hover), var(--card-son));
    }

    .avatar-btn[data-theme="pony"] {
        background: linear-gradient(145deg, var(--card-daughter), #c0236f);
    }
    .avatar-btn[data-theme="pony"]:hover {
        background: linear-gradient(145deg, var(--card-daughter-hover), var(--card-daughter));
    }

    .avatar-emoji {
        font-size: clamp(64px, 12vw, 100px);
        line-height: 1;
        filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.3));
    }

    .avatar-name {
        font-size: clamp(28px, 5vw, 42px);
        font-weight: 800;
        color: #fff;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    /* Hidden form */
    .hidden-form { display: none; }
</style>
{% endblock %}

{% block content %}
{# Floating decorations #}
<div class="stars">
    <span>&#11088;</span><span>&#127775;</span><span>&#10024;</span><span>&#127752;</span>
    <span>&#127775;</span><span>&#11088;</span><span>&#10024;</span><span>&#127752;</span>
</div>

<div class="login-container">
    <h1 class="login-title">&#128218; Who's Learning Today?</h1>

    {# Avatar selection — tap to start #}
    <div class="avatar-grid">
        {% for user in users %}
        <button
            class="avatar-btn"
            data-theme="{{ user.theme }}"
            onclick="startGame({{ user.id }})"
            type="button"
        >
            <span class="avatar-emoji">
                {% if user.theme == "racing" %}&#128663;{% else %}&#129412;{% endif %}
            </span>
            <span class="avatar-name">{{ user.name }}</span>
        </button>
        {% endfor %}
    </div>
</div>

{# Hidden form for submission #}
<form class="hidden-form" id="loginForm" method="POST" action="/login">
    <input type="hidden" name="user_id" id="formUserId">
</form>
{% endblock %}

{% block scripts %}
<script>
    window.startGame = function(userId) {
        document.getElementById('formUserId').value = userId;
        document.getElementById('loginForm').submit();
    };
</script>
{% endblock %}
